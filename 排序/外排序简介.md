## 外排序

待排序文件很大，计算机内存不能容纳整个文件，内部排序不适用。需要使用内存换进换出方式：外排序进行排序。

外排序采用的排序方式是归并排序。分为两个阶段：

1、采用适当的内部排序方式对输入文件的每个片段进行排序，排序好的片段存储至外部存储器中，这样临时缓冲区每个归并段是有序的。

2、利用归并算法归并文件。方式如下：

例如要对外存中4500个记录进行归并，而内存大小只能容纳750个记录，在第一阶段，我们可以每次读取750个记录进行排序，这样可以分六次读取，进行排序，可以得到六个有序的**归并段**，如下图：

![img](https://images2017.cnblogs.com/blog/1172457/201708/1172457-20170824204107496-53968655.png)

每个归并段的大小是750个记录，记住，这些归并段已经全部写到临时缓冲区（由一个可用的磁盘充当）内了，这是第一步的排序结果。

完成第二步该怎么做呢？这时候归并算法就有用处了，算法描述如下：

1、将内存空间划分为三份，每份大小250个记录，其中两个用作输入缓冲区，另外一个用作输出缓冲区。首先对Segment_1和Segment_2进行归并，先从每个归并段中读取250个记录到输入缓冲区，对其归并，归并结果放到输出缓冲区，当输出缓冲区满后，将其写道临时缓冲区内，如果某个输入缓冲区空了，则从相应的归并段中再读取250个记录进行继续归并，反复以上步骤，直至Segment_1和Segment_2全都排好序，形成一个大小为1500的记录，然后对Segment_3和Segment_4、Segment_5和Segment_6进行同样的操作。

2、对归并好的大小为1500的记录进行如同步骤1一样的操作，进行继续排序，直至最后形成大小为4500的归并段，至此，排序结束。

可以用一个图示表示上述算法的归并效果：![img](https://images2017.cnblogs.com/blog/1172457/201708/1172457-20170824210101886-1776687021.png)

待解决问题：

1、如何减少排序所需的归并趟数。

2、如果高效利用程序缓冲区，使得输入、输出和CPU运行尽可能地重叠。

3、如何生成初始归并段（Segment）和如何对归并段进行归并。